<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="fragments/template :: head(title='トップ')">
</head>

<style>
#modal, #qr_code {
	position: absolute;
}

#modal {
	left: 0;
	top: 0;
	background: rgba(0, 0, 0, 0.6);
	height: 100vh;
	width: 100%;
	display: none;
}

#qr_code {
	left: 50%;
	top: 50%;
	transform: translate(-50%, -50%);
}

canvas {
	width: 80vmin;
}

#staff_qr, #user_qr {
	width: 30px;
}
</style>

<body>
	<script>
		$(function() {
			var fn = {};

			fn.updateUrl = function() {
				var group = $("#group").val();
				var paths = [ "staff", "user"];
				var message = "グループIDを入力してください";
				paths.forEach( function( path){
					var linkId = "#" + path + "_link";
					var urlId = "#" + path + "_url";
					var url = $( urlId).text() + encodeURIComponent( group);
					var isValid = (group != "");

					$(linkId).text(url);
					$(linkId).attr("href", isValid ? url : "#");
					$(linkId).off("click");
					$(linkId).on("click", () => isValid ? "do nothing" : alert( message));

					var qrId= "#" + path +"_qr";
					$( qrId).off( "click");
					$( qrId).on( "click", () => isValid ? fn.showModal( linkId) : alert( message));
				});
			}

			fn.showModal = function( id){
				var url = $(id).text();
				$("#qr_code").html("");
				$("#qr_code").qrcode({text:url});
				$("#modal").fadeIn();
			}

			fn.updateUrl();
			$("#group").change(fn.updateUrl);

			$("#modal").on( "click", () => $("#modal").fadeOut());
		})
	</script>


	<h1>スタッフ呼出順管理</h1>

	<p>
		グループID <input id="group" th:value="${uuid}" />
	</p>

	<p>
	<table>
		<tr>
			<td>スタッフ用ページ</td>
			<td><img id="staff_qr" src="qr_code.png" /></td>
			<td><a id="staff_link"></a></td>
		</tr>
		<tr>
			<td>ユーザ用ページ</td>
			<td><img id="user_qr" src="qr_code.png" /></td>
			<td><a id="user_link"></a></td>
		</tr>
	</table>

	<span id="staff_url" th:text="${staff}" style="display: none"></span>
	<span id="user_url" th:text="${user}" style="display: none"></span>

	<div id="modal">
		<div id="qr_code"></div>
	</div>


	<h2>概要</h2>
	<ul style="list-style: none;">
		<li>スタッフの呼出順を管理する簡易的なシステムです。</li>
		<li>ファミレスでボタンを押すと店員を呼べるシステムを想像して頂ければ、だいたいその通りです。</li>
		<li>ユーザ用ページでスタッフ呼出を行い、スタッフ用ページで呼出一覧を確認できます。</li>
		<li>利用場面として、大学のプログラミング演習（TA・メンター・チューターの呼出）のような、限られたスタッフ人数で、大勢のユーザの対応をする場面を想定しています。</li>
		<li>「自分よりも後にスタッフを呼んだ人が、自分よりも先に対応されている」という状況を回避できます。</li>
	</ul>

	<h2>使い方</h2>
	<ul style="list-style: none">
		<li>
			<dl>
				<dt>代表の方：</dt>
				<dd>
					<dl>
						<dt>1．グループIDを変更する(任意)</dt>
						<dd>グループIDはUUIDを自動生成していますが、任意で変更が可能です。</dd>
						<dd>設定したグループIDは、ユーザ用ページやスタッフ用ページで表示されます。</dd>
						<dd>他グループとIDが一致しないように設定してください。</dd>
						<dd>特にこだわりがない場合は、デフォルトのUUIDをご利用ください。</dd>
					</dl>
					<dl>
						<dt>2．生成されたスタッフ用・ユーザ用ページのURLを利用者で共有する。</dt>
						<dd>スタッフ、ユーザ問わず、全利用者で同じグループIDを共有して下さい。</dd>
						<dd>一字でも異なると別グループとして扱われるため、URLのコピペやQRコードをご利用をお薦めします。</dd>
						<dd>また、一度共有したURLは、ブックマーク登録して繰り返し使うことができます。</dd>
					</dl>
				</dd>
			</dl>
		</li>

		<li>
			<dl>
				<dt>ユーザ：</dt>
				<dd>
					<dl>
						<dt>1．ユーザ用ページに座席番号を入力</dt>
						<dd>どのユーザによる呼出か特定できる何らかの符号(座席番号、学籍番号下3桁など)を入力してください。</dd>
					</dl>
					<dl>
						<dt>2．任意タイミングで呼出ボタン押下</dt>
						<dd>自分を含めた待ち人数が30秒毎に更新されます。</dd>
						<dd>また、呼出のデータはデータベース上で管理しているため、</dd>
						<dd>Webブラウザを閉じても呼出はキャンセルされません。</dd>
					</dl>
				</dd>
			</dl>
		</li>

		<li>
			<dl>
				<dt>スタッフ：</dt>
				<dd>
					<dl>
						<dt>1．スタッフ用ページを開く</dt>
						<dd>画面は30秒ごとに自動更新しており、呼出が発生すると呼出時刻順に表示されます。</dd>
						<dd>「呼出発生時にチャイムを鳴らす」がチェック済みなら、更新時にチャイムが鳴ります。</dd>
						<dd>ただし、パソコンがスリープ状態などの場合は更新されないため、ご注意ください。</dd>
					</dl>
				</dd>
				<dd>
					<dl>
						<dt>2．対応済み座席番号の削除ボタン押下</dt>
						<dd>削除後、他スタッフの画面にも同様に反映されます。</dd>
					</dl>
				</dd>
			</dl>
		</li>

	</ul>

	<h2>注意事項</h2>
	<ul>
		<li>JavaScriptを利用するため、無効設定は解除してください。</li>
		<li>24時間経過した呼出は自動削除されます。</li>
		<li>グループIDや座席番号はURLのクエリパラメータで保持するため、通信ログに残ります。個人情報の入力はお控えください。</li>
		<li>グループIDがすべての利用者で完全一致している必要があります。異なる場合は呼出がスタッフ用ページに反映されないため、グループIDの共有は厳密に実施してください。</li>
		<li>グループIDが特定されると外部からユーザ用ページやスタッフ用ページを介して操作できてしまうため、セキュリティ面を重視する場合はご利用をお控えください。</li>
		<li>このシステムは、事前の予告無しに仕様変更や稼働を停止することがある可能性があります。また、このシステムによる、いかなる損害の責任は負いかねます。予めご了承ください。</li>
	</ul>

	<h2>クレジット表記</h2>
	<ul style="list-style: none;">
		<li>
			<dl>
				<dt>QRコードの生成</dt>
				<dd>jeromeetienne/jquery-qrcode</dd>
				<dd>https://github.com/jeromeetienne/jquery-qrcode</dd>
			</dl>
		</li>

		<li>
			<dl>
				<dt>スタッフ用ページのチャイム</dt>
				<dd>On-Jin～音人～</dd>
				<dd>https://on-jin.com/sound/index.php</dd>
				<dd>チャイム・インターホン02</dd>
			</dl>
		</li>
	</ul>


	<h2>連絡先</h2>
	<ul style="list-style: none;">
		<li>ご意見・ご要望などは下記までご連絡ください。</li>
		<li><div>rally.elspあぁっとおぉgmail.com</div></li>
	</ul>

</body>
</html>